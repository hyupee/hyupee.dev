import { useEffect, useRef } from 'react'
import Link from 'next/link'
import BLOG from '@/blog.config'
import { useLocale } from '@/lib/locale'

const NavBar = () => {
  const locale = useLocale()
  const links = [
    { id: 0, name: locale.NAV.INDEX, to: BLOG.path || '/', show: true },
    { id: 1, name: locale.NAV.ABOUT, to: '/about', show: BLOG.showAbout },
    { id: 2, name: locale.NAV.RSS, to: '/feed', show: true },
    { id: 3, name: locale.NAV.SEARCH, to: '/search', show: true }
  ]
  return (
    <div className="flex-shrink-0">
      <ul className="flex flex-row">
        {links.map(
          link =>
            link.show && (
              <li
                key={link.id}
                className="block ml-4 text-black dark:text-gray-50 nav"
              >
                <Link href={link.to}>
                  <a>{link.name}</a>
                </Link>
              </li>
            )
        )}
      </ul>
    </div>
  )
}

const Header = ({ navBarTitle, fullWidth }) => {
  const useSticky = !BLOG.autoCollapsedNavBar
  const navRef = useRef(null)
  const sentinalRef = useRef([])
  const handler = ([entry]) => {
    if (navRef && navRef.current && useSticky) {
      if (!entry.isIntersecting && entry !== undefined) {
        navRef.current?.classList.add('sticky-nav-full')
      } else {
        navRef.current?.classList.remove('sticky-nav-full')
      }
    } else {
      navRef.current?.classList.add('remove-sticky')
    }
  }
  useEffect(() => {
    const obvserver = new window.IntersectionObserver(handler)
    obvserver.observe(sentinalRef.current)
    // Don't touch this, I have no idea how it works XD
    // return () => {
    //   if (sentinalRef.current) obvserver.unobserve(sentinalRef.current)
    // }
    /* eslint-disable-line */
  }, [sentinalRef])
  return (
    <>
      <div className="observer-element h-4 md:h-12" ref={sentinalRef}></div>
      <div
        className={`sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 ${
          !fullWidth ? 'max-w-3xl px-4' : 'px-4 md:px-24'
        }`}
        id="sticky-nav"
        ref={navRef}
      >
        <div className="flex items-center">
          <Link href="/">
            <a aria-label={BLOG.title} className="text-white font-normal text-xl">
              <svg width="97" height="21" viewBox="0 0 97 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21.976 0.0159998C22.312 0.0159998 22.568 0.0719995 22.744 0.183999C22.936 0.296 23.032 0.44 23.032 0.615999C23.032 0.695999 23.008 0.799999 22.96 0.927999C22.912 1.04 22.84 1.144 22.744 1.24C22.664 1.32 22.584 1.384 22.504 1.432C22.44 1.464 22.392 1.496 22.36 1.528C22.104 1.672 21.896 1.832 21.736 2.008C21.576 2.184 21.44 2.456 21.328 2.824L18.376 13.168C18.312 13.376 18.28 13.576 18.28 13.768C18.28 13.96 18.304 14.112 18.352 14.224C18.416 14.336 18.504 14.48 18.616 14.656C18.632 14.672 18.672 14.736 18.736 14.848C18.816 14.944 18.856 15.048 18.856 15.16C18.856 15.192 18.84 15.272 18.808 15.4C18.728 15.624 18.576 15.784 18.352 15.88C18.128 15.96 17.792 16 17.344 16H11.704C11.368 16 11.104 15.944 10.912 15.832C10.736 15.72 10.648 15.568 10.648 15.376C10.648 15.28 10.672 15.176 10.72 15.064C10.784 14.936 10.872 14.832 10.984 14.752C11.096 14.656 11.208 14.576 11.32 14.512C11.576 14.368 11.784 14.208 11.944 14.032C12.104 13.84 12.24 13.552 12.352 13.168L13.504 9.16H9.256L8.104 13.168C8.04 13.376 8.008 13.576 8.008 13.768C8.008 13.96 8.032 14.112 8.08 14.224C8.144 14.336 8.232 14.48 8.344 14.656C8.36 14.672 8.4 14.736 8.464 14.848C8.544 14.944 8.584 15.048 8.584 15.16C8.584 15.192 8.568 15.272 8.536 15.4C8.456 15.624 8.304 15.784 8.08 15.88C7.856 15.96 7.52 16 7.072 16H1.432C1.096 16 0.84 15.944 0.664 15.832C0.472 15.72 0.376 15.568 0.376 15.376C0.376 15.28 0.4 15.176 0.448 15.064C0.512 14.936 0.6 14.832 0.712 14.752C0.824 14.656 0.936 14.576 1.048 14.512C1.304 14.368 1.512 14.208 1.672 14.032C1.832 13.84 1.968 13.552 2.08 13.168L5.032 2.824C5.096 2.616 5.128 2.416 5.128 2.224C5.128 2.048 5.096 1.904 5.032 1.792C4.984 1.664 4.912 1.52 4.816 1.36C4.752 1.28 4.696 1.2 4.648 1.12C4.6 1.024 4.576 0.927999 4.576 0.831999C4.576 0.8 4.592 0.72 4.624 0.592C4.688 0.383999 4.832 0.239999 5.056 0.159999C5.28 0.0639997 5.616 0.0159998 6.064 0.0159998H11.704C12.04 0.0159998 12.296 0.0719995 12.472 0.183999C12.664 0.296 12.76 0.44 12.76 0.615999C12.76 0.695999 12.736 0.799999 12.688 0.927999C12.64 1.04 12.568 1.144 12.472 1.24C12.392 1.32 12.312 1.384 12.232 1.432C12.168 1.464 12.12 1.496 12.088 1.528C11.832 1.672 11.624 1.832 11.464 2.008C11.304 2.184 11.168 2.456 11.056 2.824L9.928 6.76H14.176L15.304 2.824C15.368 2.616 15.4 2.416 15.4 2.224C15.4 2.048 15.368 1.904 15.304 1.792C15.256 1.664 15.184 1.52 15.088 1.36C15.024 1.28 14.968 1.2 14.92 1.12C14.872 1.024 14.848 0.927999 14.848 0.831999C14.848 0.8 14.864 0.72 14.896 0.592C14.96 0.383999 15.104 0.239999 15.328 0.159999C15.552 0.0639997 15.888 0.0159998 16.336 0.0159998H21.976ZM33.7356 3.304C34.4396 3.304 34.9996 3.592 35.4156 4.168C35.8476 4.728 36.0636 5.496 36.0636 6.472C36.0636 7.32 35.9116 8.232 35.6076 9.208C35.0156 11.176 34.0636 13.032 32.7516 14.776C31.4556 16.52 29.9596 17.92 28.2636 18.976C26.5836 20.032 24.9036 20.56 23.2236 20.56C22.3916 20.56 21.6716 20.416 21.0636 20.128C20.4716 19.84 20.0236 19.456 19.7196 18.976C19.3996 18.496 19.2396 17.984 19.2396 17.44C19.2396 17.2 19.2796 16.936 19.3596 16.648C19.5036 16.2 19.7436 15.856 20.0796 15.616C20.4156 15.376 20.8156 15.256 21.2796 15.256C22.0156 15.256 22.6156 15.504 23.0796 16C23.5596 16.512 23.8636 17.208 23.9916 18.088C25.0156 18.04 25.9596 17.6 26.8236 16.768C26.0076 16.624 25.3996 16.352 24.9996 15.952C24.6156 15.536 24.3516 14.896 24.2076 14.032L23.2476 8.152C23.1996 7.848 23.1276 7.64 23.0316 7.528C22.9516 7.4 22.8396 7.336 22.6956 7.336C22.5836 7.336 22.4476 7.392 22.2876 7.504C22.1436 7.616 22.0396 7.672 21.9756 7.672C21.8476 7.672 21.7836 7.536 21.7836 7.264C21.7836 7.04 21.8236 6.8 21.9036 6.544C22.1916 5.632 22.7276 4.864 23.5116 4.24C24.2956 3.6 25.2076 3.28 26.2476 3.28C27.2716 3.28 28.0236 3.584 28.5036 4.192C28.9996 4.8 29.3196 5.736 29.4636 7L30.1836 12.28C30.2316 12.68 30.3756 12.88 30.6156 12.88C30.9036 12.88 31.2396 12.624 31.6236 12.112C32.0076 11.584 32.3836 10.84 32.7516 9.88C32.2716 9.448 31.9036 8.952 31.6476 8.392C31.3916 7.832 31.2636 7.232 31.2636 6.592C31.2636 6.096 31.3276 5.648 31.4556 5.248C31.6476 4.608 31.9436 4.128 32.3436 3.808C32.7596 3.472 33.2236 3.304 33.7356 3.304ZM50.1544 12.688C50.1224 12.816 50.1064 12.912 50.1064 12.976C50.1064 13.088 50.1304 13.176 50.1784 13.24C50.2424 13.304 50.3224 13.336 50.4184 13.336C50.6104 13.336 50.7704 13.256 50.8984 13.096C51.0424 12.92 51.1384 12.832 51.1864 12.832C51.2664 12.832 51.3304 12.888 51.3784 13C51.4424 13.096 51.4744 13.216 51.4744 13.36C51.4904 13.808 51.3304 14.256 50.9944 14.704C50.6584 15.136 50.1864 15.496 49.5784 15.784C48.9704 16.072 48.2904 16.216 47.5384 16.216C46.5944 16.216 45.8424 16.024 45.2824 15.64C44.7224 15.256 44.3624 14.752 44.2024 14.128C43.6264 14.768 42.9864 15.256 42.2824 15.592C41.5944 15.912 40.8904 16.072 40.1704 16.072C39.0504 16.072 38.1064 15.8 37.3384 15.256C36.5864 14.696 36.2104 13.92 36.2104 12.928C36.2104 12.48 36.2904 12.016 36.4504 11.536L37.9864 6.52C38.0344 6.376 38.0584 6.256 38.0584 6.16C38.0584 5.984 38.0184 5.848 37.9384 5.752C37.8584 5.64 37.7384 5.528 37.5784 5.416C37.4184 5.288 37.3064 5.176 37.2424 5.08C37.1784 4.984 37.1704 4.856 37.2184 4.696C37.3144 4.328 37.8184 4.008 38.7304 3.736C39.6424 3.448 40.5944 3.304 41.5864 3.304C42.5144 3.304 43.1944 3.48 43.6264 3.832C44.0584 4.184 44.2744 4.664 44.2744 5.272C44.2744 5.64 44.2184 5.992 44.1064 6.328L42.5944 11.32C42.5304 11.496 42.4984 11.664 42.4984 11.824C42.4984 12.048 42.5624 12.216 42.6904 12.328C42.8184 12.44 42.9864 12.496 43.1944 12.496C43.4984 12.496 43.7464 12.408 43.9384 12.232C44.1304 12.056 44.3224 11.76 44.5144 11.344L45.9784 6.52C46.0264 6.376 46.0504 6.256 46.0504 6.16C46.0504 5.984 46.0104 5.848 45.9304 5.752C45.8504 5.64 45.7384 5.528 45.5944 5.416C45.4344 5.288 45.3224 5.176 45.2584 5.08C45.1944 4.984 45.1864 4.856 45.2344 4.696C45.3144 4.328 45.8104 4.008 46.7224 3.736C47.6344 3.448 48.5864 3.304 49.5784 3.304C50.5064 3.304 51.1864 3.48 51.6184 3.832C52.0664 4.184 52.2904 4.656 52.2904 5.248C52.2904 5.552 52.2264 5.912 52.0984 6.328L50.1544 12.688ZM64.9036 3.208C66.1356 3.208 67.1036 3.616 67.8076 4.432C68.5116 5.248 68.8636 6.36 68.8636 7.768C68.8636 8.52 68.7596 9.312 68.5516 10.144C68.0716 12.128 67.1756 13.64 65.8636 14.68C64.5516 15.704 63.0316 16.216 61.3036 16.216C60.1996 16.216 59.2396 15.984 58.4236 15.52L57.6556 18.088C57.5916 18.264 57.5596 18.432 57.5596 18.592C57.5596 18.768 57.5996 18.912 57.6796 19.024C57.7596 19.152 57.8636 19.272 57.9916 19.384C58.1196 19.512 58.1996 19.616 58.2316 19.696C58.2796 19.776 58.2876 19.872 58.2556 19.984C58.1916 20.192 58.0396 20.336 57.7996 20.416C57.5596 20.512 57.1916 20.56 56.6956 20.56H51.1996C50.7836 20.56 50.4876 20.488 50.3116 20.344C50.1196 20.216 50.0636 20.048 50.1436 19.84C50.1756 19.712 50.2316 19.608 50.3116 19.528C50.3916 19.448 50.5036 19.376 50.6476 19.312C50.8876 19.152 51.0796 18.984 51.2236 18.808C51.3676 18.648 51.4956 18.384 51.6076 18.016L55.1116 6.52C55.1596 6.376 55.1836 6.256 55.1836 6.16C55.1836 5.984 55.1436 5.848 55.0636 5.752C54.9836 5.64 54.8636 5.528 54.7036 5.416C54.5436 5.288 54.4316 5.176 54.3676 5.08C54.3036 4.984 54.2956 4.856 54.3436 4.696C54.4396 4.328 54.9436 4.008 55.8556 3.736C56.7676 3.448 57.7196 3.304 58.7116 3.304C59.4156 3.304 59.9916 3.48 60.4396 3.832C60.9036 4.184 61.1676 4.672 61.2316 5.296C62.3196 3.904 63.5436 3.208 64.9036 3.208ZM62.1196 10.336C62.5036 8.912 62.6956 7.928 62.6956 7.384C62.6956 7.048 62.6396 6.832 62.5276 6.736C62.4316 6.624 62.2876 6.568 62.0956 6.568C61.9516 6.568 61.7676 6.64 61.5436 6.784C61.3196 6.912 61.0956 7.136 60.8716 7.456L58.9756 13.744C59.1676 13.936 59.3996 14.032 59.6716 14.032C60.1036 14.032 60.5116 13.792 60.8956 13.312C61.2956 12.816 61.7036 11.824 62.1196 10.336ZM77.0813 3.184C79.1133 3.184 80.5853 3.512 81.4973 4.168C82.4093 4.808 82.8653 5.632 82.8653 6.64C82.8653 6.944 82.8333 7.224 82.7693 7.48C82.5293 8.536 81.8573 9.296 80.7533 9.76C79.6653 10.208 78.3773 10.432 76.8893 10.432C76.1373 10.432 75.4333 10.384 74.7773 10.288C74.7613 11.12 74.9853 11.704 75.4493 12.04C75.9133 12.376 76.5613 12.544 77.3933 12.544C77.7773 12.544 78.1453 12.504 78.4973 12.424C78.8493 12.328 79.2973 12.192 79.8413 12.016C80.2893 11.856 80.5933 11.776 80.7533 11.776C80.9293 11.776 81.0173 11.88 81.0173 12.088C81.0333 12.648 80.8253 13.24 80.3933 13.864C79.9613 14.472 79.3213 14.992 78.4733 15.424C77.6253 15.856 76.6013 16.072 75.4013 16.072C73.6253 16.072 72.1693 15.624 71.0333 14.728C69.8973 13.832 69.3293 12.528 69.3293 10.816C69.3293 10.336 69.3933 9.776 69.5213 9.136C69.9213 7.168 70.7933 5.688 72.1373 4.696C73.4973 3.688 75.1453 3.184 77.0813 3.184ZM74.9453 8.848C75.0093 8.864 75.0973 8.872 75.2093 8.872C75.8813 8.872 76.3933 8.56 76.7453 7.936C77.0973 7.312 77.2653 6.616 77.2493 5.848C77.2333 5.4 77.1053 5.176 76.8653 5.176C76.6893 5.176 76.4813 5.32 76.2413 5.608C76.0013 5.88 75.7613 6.296 75.5213 6.856C75.2973 7.416 75.1053 8.08 74.9453 8.848ZM90.511 3.184C92.543 3.184 94.015 3.512 94.927 4.168C95.839 4.808 96.295 5.632 96.295 6.64C96.295 6.944 96.263 7.224 96.199 7.48C95.959 8.536 95.287 9.296 94.183 9.76C93.095 10.208 91.807 10.432 90.319 10.432C89.567 10.432 88.863 10.384 88.207 10.288C88.191 11.12 88.415 11.704 88.879 12.04C89.343 12.376 89.991 12.544 90.823 12.544C91.207 12.544 91.575 12.504 91.927 12.424C92.279 12.328 92.727 12.192 93.271 12.016C93.719 11.856 94.023 11.776 94.183 11.776C94.359 11.776 94.447 11.88 94.447 12.088C94.463 12.648 94.255 13.24 93.823 13.864C93.391 14.472 92.751 14.992 91.903 15.424C91.055 15.856 90.031 16.072 88.831 16.072C87.055 16.072 85.599 15.624 84.463 14.728C83.327 13.832 82.759 12.528 82.759 10.816C82.759 10.336 82.823 9.776 82.951 9.136C83.351 7.168 84.223 5.688 85.567 4.696C86.927 3.688 88.575 3.184 90.511 3.184ZM88.375 8.848C88.439 8.864 88.527 8.872 88.639 8.872C89.311 8.872 89.823 8.56 90.175 7.936C90.527 7.312 90.695 6.616 90.679 5.848C90.663 5.4 90.535 5.176 90.295 5.176C90.119 5.176 89.911 5.32 89.671 5.608C89.431 5.88 89.191 6.296 88.951 6.856C88.727 7.416 88.535 8.08 88.375 8.848Z" fill="white"/>
              </svg>
            </a>
          </Link>
          {navBarTitle
            ? (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {navBarTitle}
            </p>
              )
            : (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {BLOG.title},{' '}
              <span className="font-normal">{BLOG.description}</span>
            </p>
              )}
        </div>
        <NavBar />
      </div>
    </>
  )
}

export default Header
